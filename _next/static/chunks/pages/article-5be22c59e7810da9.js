(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38],{5353:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(4379),i=n(4848);function c(e){var t=e.authors,n=e.onClick;return(0,i.jsx)(i.Fragment,{children:t.map(function(e){return(0,i.jsx)(r.A,{onClick:function(){n?n(e):window.open("/articles?author=".concat(encodeURIComponent(e)),"_blank")},sx:{m:.3},label:e},e)})})}},1878:(e,t,n)=>{"use strict";n.d(t,{M:()=>c});var r=n(1952),i=n(4848);function c(e){var t=e.diff;return t?(0,i.jsx)(i.Fragment,{children:t.map(function(e,t){return(0,i.jsx)(r.A,{variant:"body1",sx:{margin:.5},children:e.map(function(e,t){return(0,i.jsx)("span",{style:{color:1===e[0]?"green":-1===e[0]?"red":"inherit"},children:e[1]},t)})},t)})}):null}},1854:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(4379),i=n(1952),c=n(6540),o=n(2516),s=n(4848);function a(e){var t=e.tags,n=e.onClick,a=(0,c.useState)(null),l=a[0],u=a[1],d=(0,c.useState)(""),f=d[0],h=d[1],x=function(){u(null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Ay,{open:!!l,anchorEl:l,disableRestoreFocus:!0,sx:{pointerEvents:"none",marginTop:"10px"},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,s.jsx)(i.A,{sx:{p:1},children:f})}),t.map(function(e){return(0,s.jsx)(r.A,{onMouseEnter:function(t){h(e.type),u(t.currentTarget)},onMouseLeave:x,onClick:function(){n?n(e):window.open("/articles?tag=".concat(encodeURIComponent(e.name)),"_blank")},sx:{m:.3,lineHeight:"34px",float:"left"},label:e.name},e.type+"##"+e.name)})]})}},7275:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eh});var r=n(3556),i=n(8242),c=n(3439),o=n(4756),s=n.n(o),a=n(6540),l=n(2189),u=n(3368),d=n.n(u),f=n(9639),h=n(2548),x=n(2429),p=n(6437),m=n(8170),g=n(1567),j=n(9623),v=n(4379),b=n(1423),A=n(2819),y=n(5912),w=n(1952),_=n(6809),O=n(4976),C=n(1878),S=n(1854),k=n(5353),P=n(5536),I=n(2516),M=n(4954),E=n(9946),z=n(9668),B=n(9820),R=n(6493),D=n(6647),F=n(2664),U=n(1558),N=n(637),T=n(8335),W=n(4848);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function X(e){var t=H(H({},e),{},{insertBefore:e.insertBefore.map(function(e){return{text:e.text}}),insertAfter:e.insertAfter.map(function(e){return{text:e.text}})});return t.insertBefore.length||delete t.insertBefore,t.insertAfter.length||delete t.insertAfter,t}function q(e){var t=e.onClose,n=(0,a.useState)(""),r=n[0],i=n[1];return(0,W.jsxs)(D.A,{onClose:function(){return t()},open:!0,children:[(0,W.jsx)(F.A,{children:"插入"}),(0,W.jsxs)(A.A,{spacing:2,p:2,children:[(0,W.jsx)(R.A,{size:"small",value:r,onChange:function(e){return i(e.target.value)},multiline:!0,autoFocus:!0}),(0,W.jsxs)(U.A,{children:[(0,W.jsx)(b.A,{onClick:function(){return t(r)},children:"确定"}),(0,W.jsx)(b.A,{onClick:function(){return t()},children:"取消"})]})]})]})}function V(e){var t=e.content,n=e.onChange,r=(0,a.useState)(!1),c=r[0],o=r[1],s=(0,a.useState)(!1),u=s[0],d=s[1],f=(0,a.useState)([]),h=f[0],x=f[1],p=(0,a.useState)([]),m=p[0],g=p[1],j=(0,a.useState)(!t),v=j[0],y=j[1],w=(0,a.useRef)({insertBefore:[],insertAfter:[]}),_=(0,a.useState)(t),O=_[0],C=_[1],S=(0,W.jsxs)(A.A,{direction:"row",sx:{mt:1,mb:1},spacing:1,children:[(0,W.jsx)(R.A,{sx:{flex:1},size:"small",onChange:function(e){var r=H({},w.current);if(e.target.value.length){delete r.delete,y(!1);var i=new l.diff_match_patch().diff_main(t,e.target.value);t?1!==i.length?r.diff=new l.diff_match_patch().diff_toDelta(i):delete r.diff:r.diff=new l.diff_match_patch().diff_toDelta(i)}else r.delete=!0,y(!0);w.current=r,n(X(r)),C(e.target.value)},value:O,multiline:!0}),(0,W.jsxs)(A.A,{spacing:1,children:[(0,W.jsx)(b.A,{size:"small",variant:"outlined",onClick:function(){return o(!0)},children:"上方插入"}),(0,W.jsx)(b.A,{size:"small",variant:"outlined",onClick:function(){return d(!0)},children:"下方插入"}),(0,W.jsx)(N.A,{control:(0,W.jsx)(T.A,{size:"small",checked:v,onChange:function(e){O.length&&(y(e.target.checked),w.current=H(H({},w.current),{},{delete:e.target.checked}),n(X(w.current)))}}),label:"删除"})]})]});return(0,W.jsxs)(W.Fragment,{children:[h.map(function(e){return(0,W.jsx)("li",{children:(0,W.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,W.jsx)(R.A,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,W.jsx)(b.A,{variant:"outlined",size:"small",onClick:function(){w.current.insertBefore=h.filter(function(t){return t.id!==e.id}),x(w.current.insertBefore),n(X(w.current))},children:"删除"})]})},e.id)}),c?(0,W.jsx)(q,{onClose:function(e){if(!e){o(!1);return}var t=[].concat((0,i.A)(h),[{id:Math.random().toString(),text:e}]);x(t),o(!1),w.current.insertBefore=t,n(X(w.current))}}):null,u?(0,W.jsx)(q,{onClose:function(e){if(!e){d(!1);return}var t=[].concat((0,i.A)(m),[{id:Math.random().toString(),text:e}]);g(t),d(!1),w.current.insertAfter=t,n(X(w.current))}}):null,v?S:(0,W.jsx)("li",{children:S},"center"),m.map(function(e){return(0,W.jsx)("li",{children:(0,W.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,W.jsx)(R.A,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,W.jsx)(b.A,{variant:"outlined",size:"small",onClick:function(){w.current.insertAfter=m.filter(function(t){return t.id!==e.id}),g(w.current.insertAfter),n(X(w.current))},children:"删除"})]})},e.id)})]})}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function J(e){var t=e.onClose,n=(0,a.useState)(""),r=n[0],i=n[1],c=(0,a.useState)(B.cM.paragraph),o=c[0],s=c[1];return(0,W.jsxs)(D.A,{onClose:function(){return t()},open:!0,children:[(0,W.jsx)(F.A,{children:"插入段落"}),(0,W.jsxs)(A.A,{spacing:2,p:2,children:[(0,W.jsx)(R.A,{size:"small",value:r,onChange:function(e){return i(e.target.value)},multiline:!0,autoFocus:!0}),(0,W.jsx)(w.A,{children:"类型："}),(0,W.jsx)(f.A,{sx:{width:130},size:"small",defaultValue:o,onChange:function(e){s(e.target.value)},children:Object.keys(B.cM).map(function(e){return(0,W.jsx)(j.A,{value:e,children:e},e)})}),(0,W.jsxs)(U.A,{children:[(0,W.jsx)(b.A,{onClick:function(){return t(o,r)},children:"确定"}),(0,W.jsx)(b.A,{onClick:function(){return t()},children:"取消"})]})]})]})}function G(e){var t=Q(Q({},e),{},{insertBefore:e.insertBefore.map(function(e){return{type:e.type,text:e.text}}),insertAfter:e.insertAfter.map(function(e){return{type:e.type,text:e.text}})});return t.insertBefore.length||delete t.insertBefore,t.insertAfter.length||delete t.insertAfter,t}function K(e){var t=e.idx,n=e.content,r=e.comments,c=e.onChange,o=(0,a.useState)(!1),s=o[0],u=o[1],d=(0,a.useState)(!1),h=d[0],x=d[1],p=(0,a.useState)([]),m=p[0],g=p[1],v=(0,a.useState)([]),y=v[0],_=v[1],O=(0,a.useState)(!1),C=O[0],S=O[1],k=(0,a.useRef)({insertBefore:[],insertAfter:[]}),I=(0,a.useMemo)(function(){var e=Array.from(n.text);return r.filter(function(e){return e.part_idx===t}).sort(function(e,t){return t.index-e.index}).forEach(function(t){return e.splice(t.offset,0,"".concat(P.PP).concat(t.index).concat(P.UQ))}),e.join("")},[n,r,t]),M=(0,a.useState)(I),E=M[0],z=M[1];return(0,W.jsxs)(W.Fragment,{children:[m.map(function(e){return(0,W.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,W.jsx)(R.A,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,W.jsx)(w.A,{variant:"caption",children:e.type}),(0,W.jsx)(b.A,{variant:"outlined",size:"small",onClick:function(){k.current.insertBefore=m.filter(function(t){return t.id!==e.id}),g(k.current.insertBefore),c(G(k.current))},children:"删除"})]},e.id)}),s?(0,W.jsx)(J,{onClose:function(e,t){if(e&&t){var n=[].concat((0,i.A)(m),[{id:Math.random().toString(),type:e,text:t}]);g(n),u(!1),k.current.insertBefore=n,c(G(k.current))}}}):null,h?(0,W.jsx)(J,{onClose:function(e,t){if(e&&t){var n=[].concat((0,i.A)(y),[{id:Math.random().toString(),type:e,text:t}]);_(n),x(!1),k.current.insertAfter=n,c(G(k.current))}}}):null,(0,W.jsxs)(A.A,{direction:"row",sx:{mt:1,mb:1},spacing:1,children:[(0,W.jsx)(R.A,{sx:{flex:1},size:"small",onChange:function(e){var t=Q({},k.current);if(e.target.value.length){delete t.delete,S(!1);var n=new l.diff_match_patch().diff_main(I,e.target.value);1===n.length&&I?delete t.diff:t.diff=new l.diff_match_patch().diff_toDelta(n)}else t.delete=!0,delete t.diff,S(!0);k.current=t,c(G(t)),z(e.target.value)},value:E,multiline:!0},n.id),(0,W.jsxs)(A.A,{spacing:1,children:[(0,W.jsx)(f.A,{sx:{width:130},size:"small",defaultValue:n.type,onChange:function(e){k.current=Q(Q({},k.current),{},{type:e.target.value}),c(G(k.current))},children:Object.keys(B.cM).map(function(e){return(0,W.jsx)(j.A,{value:e,children:e},e)})}),(0,W.jsx)(b.A,{size:"small",variant:"outlined",onClick:function(){return u(!0)},children:"上方插入"}),(0,W.jsx)(b.A,{size:"small",variant:"outlined",onClick:function(){return x(!0)},children:"下方插入"}),(0,W.jsx)(N.A,{control:(0,W.jsx)(T.A,{size:"small",checked:C,onChange:function(e){E.length&&(S(e.target.checked),k.current=Q(Q({},k.current),{},{delete:e.target.checked}),c(G(k.current)))}}),label:"删除"})]})]}),y.map(function(e){return(0,W.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,W.jsx)(R.A,{disabled:!0,multiline:!0,sx:{flex:1},value:e.text}),(0,W.jsx)(w.A,{variant:"caption",children:e.type}),(0,W.jsx)(b.A,{variant:"outlined",size:"small",onClick:function(){k.current.insertAfter=y.filter(function(t){return t.id!==e.id}),_(k.current.insertAfter),c(G(k.current))},children:"删除"})]},e.id)})]})}var $=n(7836).env.COMMIT_HASH;function Z(e){var t,n=e.contents,r=e.comments,c=(e.description,e.article),o=e.articleId,s=e.publicationId,u=e.publicationName,d=(0,a.useRef)({version:2,parts:{},comments:{},description:""}),f=(0,a.useState)(""),h=f[0],x=f[1],p=(0,a.useState)(null),m=p[0],g=p[1];return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(A.A,{sx:{mb:1},spacing:1,direction:"row",children:(0,W.jsx)(b.A,{variant:"outlined",size:"small",onClick:function(){return window.open("https://github.com/banned-historical-archives/banned-historical-archives.github.io/wiki/%E6%A0%87%E5%87%86%E5%8C%96%E6%96%87%E7%A8%BF%E5%BD%95%E5%85%A5%E4%B8%8E%E6%A0%A1%E5%AF%B9","_blank")},children:"校对注意事项"})}),(0,W.jsx)(I.Ay,{open:!!m,anchorEl:m,onClose:function(){return g(null)},children:(0,W.jsx)(R.A,{multiline:!0,value:h})}),n.map(function(e,t){return(0,W.jsx)(K,{onChange:function(n){n.diff||n.delete||n.type&&n.type!==e.type||n.insertAfter||n.insertBefore?d.current.parts[t]=n:delete d.current.parts[t]},idx:t,comments:r,content:e},e.id)}),(0,W.jsx)(y.A,{sx:{mt:2,mb:2}}),(0,W.jsx)(w.A,{variant:"h6",sx:{mb:2},children:"描述"}),(t=r.find(function(e){return -1===e.index})||{index:-1,text:""},(0,W.jsx)(R.A,{defaultValue:t.text,multiline:!0,onChange:function(e){if(0===e.target.value.length){delete d.current.description;return}var n=new l.diff_match_patch().diff_main(t.text,e.target.value);t.text&&1===n.length?d.current.description="":d.current.description=new l.diff_match_patch().diff_toDelta(n)}})),(0,W.jsx)(y.A,{sx:{mt:2,mb:2}}),(0,W.jsx)(w.A,{variant:"h6",sx:{mb:2},children:"注释"}),(0,W.jsx)("ol",{children:r.filter(function(e){return -1!==e.index}).length?r.filter(function(e){return -1!==e.index}).map(function(e,t){return(0,W.jsx)(V,{content:e.text,onChange:function(t){t.diff||t.delete||t.insertAfter||t.insertBefore?d.current.comments[e.index]=t:delete d.current.comments[e.index]}},t)}):(0,W.jsx)(V,{content:"",onChange:function(e){e.diff||e.insertAfter||e.insertBefore?d.current.newComments=[].concat((0,i.A)((e.insertBefore||[]).map(function(e){return e.text})),(0,i.A)(e.diff?[new l.diff_match_patch().diff_fromDelta("",e.diff).filter(function(e){return -1!==e[0]}).map(function(e){return e[1]}).join("")]:[]),(0,i.A)((e.insertAfter||[]).map(function(e){return e.text}))):delete d.current.newComments}},"virtual")}),(0,W.jsxs)(A.A,{spacing:1,children:[(0,W.jsx)(b.A,{variant:"contained",size:"small",sx:{width:80,mt:1},onClick:function(){var e=JSON.stringify({articleId:o,publicationId:s,commitHash:$,patch:d.current}),t="https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues/new?title=".concat(encodeURIComponent("[OCR patch]".concat(c.title,"[").concat(u,"][").concat(o,"][").concat(s,"]")),"&body=").concat(encodeURIComponent("{OCR补丁}\n".concat(e,"\n请复制以上代码在对比选项中粘贴进行预览：https://banned-historical-archives.github.io/articles/").concat(o,"\n")));window.open(t,"_blank")},children:"提交变更"}),(0,W.jsxs)(w.A,{children:["如果出现 Your request URL is too long 的错误，请点击",(0,W.jsx)(b.A,{size:"small",onClick:function(e){var t=JSON.stringify({articleId:o,publicationId:s,commitHash:$,patch:d.current}),n="{OCR补丁}\n".concat(t,"\n请复制以上代码在对比选项中粘贴进行预览：https://banned-historical-archives.github.io/articles/").concat(o);navigator.clipboard.writeText(n);var r="https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues/new?title=".concat(encodeURIComponent("[OCR patch]".concat(c.title,"[").concat(u,"][").concat(o,"][").concat(s,"]")));window.open(r,"_blank"),x(n),g(e.currentTarget)},children:"复制代码并跳转"}),"，粘贴代码再提交。"]}),(0,W.jsx)(w.A,{children:"如果核对无误也可以提交，使其他人知道此文稿已经被校对（可多次提交，表示多次核对）"})]})]})}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function en(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function er(e){var t=e.description,n=e.comments,r=e.contents,i=(0,a.useRef)(),o=(0,a.useRef)(null),l=(0,a.useState)(!1),u=l[0],d=l[1],h=(0,a.useState)(1),g=h[0],v=h[1],_=(0,a.useState)(1),O=_[0],C=_[1],S=(0,a.useState)(null),k=S[0],R=S[1],D=(0,a.useState)(!1),F=D[0],U=D[1],N=(0,a.useState)([]),T=N[0],L=N[1],H=(0,a.useState)(),X=H[0],q=H[1],V=(0,a.useState)(-1),Y=V[0],Q=V[1];(0,a.useEffect)(function(){Y<0||(i.current=new SpeechSynthesisUtterance(r[Y].text),i.current.voice=T.find(function(e){return e.name==X}),i.current.pitch=g,i.current.rate=O,speechSynthesis.speak(i.current),i.current.onerror=function(e){return console.error("发生错误：",e.error)},i.current.onend=function(){r.length-1>Y?Q(Y+1):(d(!1),i.current.onend=null,speechSynthesis.cancel(),Q(-1))})},[Y,r]),(0,a.useEffect)(function(){(0,c.A)(s().mark(function e(){var t,n,r,i,c,o;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.speechSynthesis){e.next=2;break}return e.abrupt("return");case 2:o=speechSynthesis.getVoices();case 3:if(o.length){e.next=9;break}return o=speechSynthesis.getVoices(),e.next=7,(0,P.yy)(100);case 7:e.next=3;break;case 9:L(o.sort(function(e,t){return e.lang>t.lang?1:-1})),q(localStorage.getItem("tts_voice")||(null===(t=o.find(function(e){return e.lang.startsWith("zh_CN")}))||void 0===t?void 0:t.name)||(null===(n=o.find(function(e){return e.lang.startsWith("zh-CN")}))||void 0===n?void 0:n.name)||(null===(r=o.find(function(e){return e.name.indexOf("中国")>=0}))||void 0===r?void 0:r.name)||(null===(i=o.find(function(e){return e.name.indexOf("中文")>=0}))||void 0===i?void 0:i.name)||(null===(c=o[0])||void 0===c?void 0:c.name)),v(parseFloat(localStorage.getItem("tts_pitch")||"1")),C(parseFloat(localStorage.getItem("tts_rate")||"1"));case 13:case"end":return e.stop()}},e)}))()},[]);var J=(0,a.useMemo)(function(){return r.map(function(e,t){var r=t===Y,i=r?function(e){e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}:void 0,c=r?{color:"#cf0000"}:{},o=[],s=n.filter(function(t){return t.part_idx===e.index}),a=e.text,l=0,u=[];if(s.length){var d,f=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return en(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return en(e,void 0)}}(e))){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,c=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw c}}}}(s);try{for(f.s();!(d=f.n()).done;){var h=d.value,x=a.substr(l,h.offset-l);u.push(x),l+=x.length}}catch(e){f.e(e)}finally{f.f()}l<a.length&&u.push(a.substr(l))}else u.push(a);var p=[];u.forEach(function(e,t){if(p.push((0,W.jsx)("span",{children:e},"".concat((0,P.DM)(e),"-").concat(t))),o.push(e),s.length){var n=s.shift().index;o.push("〔".concat(n,"〕")),p.push((0,W.jsxs)("a",{id:"comment".concat(n,"_content"),href:"#comment".concat(n,"_comment"),style:{userSelect:"none"},children:[P.PP,n,P.UQ]},Math.random()))}}),e.type===B.cM.title?o.unshift("# "):e.type===B.cM.subtitle?o.unshift("## "):e.type===B.cM.subtitle2?o.unshift("### "):e.type===B.cM.subtitle3&&o.unshift("#### ");var m=e.id;if(e.type===B.cM.title)return(0,W.jsx)(w.A,{ref:i,variant:"h5",sx:et({textAlign:"center",margin:4},c),children:p},m);if(e.type===B.cM.appellation)return(0,W.jsx)(w.A,{ref:i,variant:"body1",sx:et({margin:.5,fontWeight:"bold"},c),children:p},m);if(e.type===B.cM.image)return(0,W.jsx)("img",{alt:"",ref:i,src:e.text,style:{width:"50%",display:"block",margin:"auto",marginTop:"1.25em"}},m);if(e.type===B.cM.image_description)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center",marginBottom:"1.25em"},c),children:p},m);if(e.type===B.cM.subdate)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center"},c),children:p},m);if(e.type===B.cM.place)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center"},c),children:p},m);if(e.type===B.cM.authors)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center"},c),children:p},m);else if(e.type===B.cM.signature)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"right"},c),children:p},m);else if(e.type===B.cM.subtitle)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center",fontSize:"1.5em",fontWeight:"bold",margin:"1.25em 0 1.25em 0"},c),children:p},m);else if(e.type===B.cM.subtitle2)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center",fontSize:"1.17em",fontWeight:"bold",margin:"1.25em 0 1.25em 0"},c),children:p},m);else if(e.type===B.cM.subtitle3)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center",fontWeight:"bold",margin:"0.625em 0 0.625em 0"},c),children:p},m);else if(e.type===B.cM.subtitle4||e.type===B.cM.subtitle5)return(0,W.jsx)(w.A,{ref:i,variant:"subtitle1",sx:et({textAlign:"center"},c),children:p},m);else if(e.type===B.cM.paragraph)return(0,W.jsx)(w.A,{variant:"body1",ref:i,sx:et({textIndent:"2em",margin:.5},c),children:p},m);else if(e.type===B.cM.quotation)return(0,W.jsx)(A.A,{ref:i,spacing:1,children:e.text.split("\n").filter(function(e){return e}).map(function(e,t){return(0,W.jsx)(w.A,{variant:"body1",sx:et({color:"grey",padding:"0.625em 2.5em 0.625em 2.5em",borderLeft:"2px solid"},c),children:e},t)})},m);else return(0,W.jsx)(w.A,{ref:i,variant:"body1",sx:et({textIndent:"2em",margin:.5},c),children:p},m)})},[r,Y]),G=t?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(y.A,{sx:{mt:2,mb:2}}),(0,W.jsx)(w.A,{variant:"h6",sx:{mb:2},children:"描述"}),(0,W.jsx)(A.A,{spacing:1,children:t.split("\n").filter(function(e){return e}).map(function(e,t){return(0,W.jsx)(w.A,{variant:"body1",children:e},t)})})]}):null,K=n.filter(function(e){return -1!==e.index}).length?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(y.A,{sx:{mt:2,mb:2}}),(0,W.jsx)(w.A,{variant:"h6",sx:{mb:2},children:"注释"}),n.filter(function(e){return -1!==e.index}).map(function(e,t){return(0,W.jsxs)(A.A,{direction:"row",children:[(0,W.jsx)("span",{children:(0,W.jsxs)("a",{id:"comment".concat(t+1,"_comment"),href:"#comment".concat(t+1,"_content"),style:{userSelect:"none"},children:[P.PP,t+1,P.UQ]})}),(0,W.jsx)(A.A,{spacing:1,children:e.text.split("\n").filter(function(e){return e}).map(function(e,t){return(0,W.jsx)(w.A,{variant:"body1",children:e},t)})})]},e.id)})]}):null;return(0,W.jsx)(W.Fragment,{children:(0,W.jsxs)("div",{style:{position:"relative"},children:[(0,W.jsx)(b.A,{sx:{position:"absolute",visibility:X?"visible":"hidden",top:4,left:0,minWidth:0,opacity:"0.5",width:"20px",height:"20px",borderRadius:"10px"},ref:function(e){R(e)},onClick:function(){u?(d(!1),i.current.onend=null,speechSynthesis.cancel(),Q(-1)):U(!F)},children:u?(0,W.jsx)(z.A,{}):(0,W.jsx)(E.A,{})}),(0,W.jsx)(I.Ay,{open:F,anchorEl:k,onClose:function(){return U(!1)},sx:{marginTop:"10px"},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,W.jsxs)(m.A,{container:!0,alignItems:"center",justifyContent:"center",sx:{p:2,width:"400px"},spacing:2,rowSpacing:1,children:[(0,W.jsx)(m.A,{size:12,children:(0,W.jsxs)(p.A,{fullWidth:!0,children:[(0,W.jsx)(x.A,{id:"demo-simple-select-label",children:"语音"}),(0,W.jsx)(f.A,{labelId:"demo-simple-select-label",value:X,label:"语音",onChange:function(e){q(e.target.value),localStorage.setItem("tts_voice",e.target.value)},children:T.map(function(e){return(0,W.jsxs)(j.A,{value:e.name,children:[e.lang,"-",e.name]},e.name)})})]})}),(0,W.jsx)(m.A,{size:2,children:(0,W.jsx)(w.A,{children:"速度"})}),(0,W.jsx)(m.A,{size:10,children:(0,W.jsx)(M.Ay,{value:O,valueLabelDisplay:"auto",step:.1,marks:!0,min:.1,max:2,onChange:function(e,t){C(t),localStorage.setItem("tts_rate",t.toString())}})}),(0,W.jsx)(m.A,{size:2,children:(0,W.jsx)(w.A,{children:"音高"})}),(0,W.jsx)(m.A,{size:10,children:(0,W.jsx)(M.Ay,{value:g,valueLabelDisplay:"auto",step:.1,marks:!0,min:.1,max:2,onChange:function(e,t){v(t),localStorage.setItem("tts_pitch",t.toString())}})}),(0,W.jsx)(m.A,{size:12,children:(0,W.jsx)(b.A,{variant:"outlined",onClick:function(){d(!0),U(!1),Q(0)},children:"朗读"})})]})}),(0,W.jsxs)("div",{ref:o,children:[J,G,K]})]})})}function ei(e){var t=e.article,n=e.articleId,r=e.comments,i=e.patchable,c=e.contents,o=e.publicationId,s=e.publicationName,a=e.description;return c=c.sort(function(e,t){return e.index>t.index?1:-1}),r=r.sort(function(e,t){return e.index-t.index}),i?(0,W.jsx)(Z,{articleId:n,article:t,comments:r,contents:c,description:a,publicationId:o,publicationName:s}):(0,W.jsx)(er,{description:a,comments:r,contents:c})}var ec=n(7836);function eo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function es(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}_.Uy.GlobalWorkerOptions.workerSrc="/pdfjs-dist/legacy/build/pdf.worker.min.js",ec.env.COMMIT_HASH;var ea="--preview-patch--",el=function(e){return e.none="none",e.origin="origin",e.originProofread="originProofread",e.version="version",e}(el||{});function eu(e){var t="";return e.forEach(function(e){return t+=e.text}),t}function ed(e){return[e.year||"",e.month||"",e.day||""].filter(function(e){return e}).join(".")}var ef=function(e){return e.line="逐行对比",e.literal="逐字对比",e.description_and_comments="描述和注释",e}(ef||{});function eh(){var e,t=(0,a.useState)([]),r=t[0],o=t[1],u=(0,a.useState)(),O=u[0],I=u[1],M=(0,a.useRef)(r),E=(0,a.useState)(1),z=E[0],B=E[1],R=(0,a.useState)(!0),D=R[0],F=R[1],U=(0,a.useState)(null),N=U[0],T=U[1],L=(0,a.useState)(el.none),H=L[0],X=L[1],q=(0,a.useState)(),V=q[0],Y=q[1],Q=(0,a.useState)(ef.line),J=Q[0],G=Q[1],K=(0,a.useState)(),$=K[0],Z=K[1];null===(e=(n.g||window).location)||void 0===e||e.hostname,(0,a.useEffect)(function(){(0,c.A)(s().mark(function e(){var t,n;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams(location.search).get("id"),e.next=3,fetch("https://raw.githubusercontent.com/banned-historical-archives/banned-historical-archives.github.io/json/json/".concat(t.slice(0,3),"/").concat(t,".json"));case 3:return e.next=5,e.sent.json();case 5:n=e.sent,I(t),o(n.books),M.current=n.books,Y(n.books[n.books.length-1].id),Z(n.books[0].id);case 11:case"end":return e.stop()}},e)}))()},[]);var ee=(0,a.useCallback)(function(e,t){M.current=M.current.filter(function(e){return e.id!=ea}),M.current.push({id:ea,type:"",tags:[],files:[],name:"#OCR补丁预览#",article:(0,P.fQ)(M.current.find(function(t){return t.id==e}).article,t)})},[]);(0,a.useEffect)(function(){var e=new URLSearchParams(location.search);e.get("publication_id")&&Z(e.get("publication_id"))},[]);var et=(0,a.useMemo)(function(){if(!V||!$||H!==el.version)return[];var e=M.current.find(function(e){return e.id==$}).article,t=M.current.find(function(e){return e.id==V}).article,n=e.comments,r=t.comments,c=e.parts,o=t.parts;if(J===ef.literal)return[new l.diff_match_patch().diff_main(eu([{text:eu(c)}]),eu([{text:eu(o)}]))];if(J===ef.description_and_comments){var s=Math.max(n.length,r.length);return[new l.diff_match_patch().diff_main(e.description||"",t.description||"")].concat((0,i.A)(Array(s).fill(0).map(function(e,t){return new l.diff_match_patch().diff_main(n[t]||"",r[t]||"")})))}for(var a=Math.max(c.length,o.length),u=0,d=[];u<a;){var f=c[u]?c[u].text:"",h=o[u]?o[u].text:"";d.push(new l.diff_match_patch().diff_main(f,h)),++u}return d},[$,H,J,V]),en=!!N,er=r.find(function(e){return e.id==$}),ec=r.find(function(e){return e.id==V}),eo=null==er?void 0:er.article;if(!eo||!ec)return null;var eh=[];r.forEach(function(e){e.article.alias&&eh.push(e.article.alias)});var ex=eo.description,ep=eo.parts,em=eo.comments,eg=eo.page_start,ej=eo.page_end,ev=eo.comment_pivots,eb=em.map(function(e,t){var n,r,i;return{text:e,id:t.toString(),offset:null===(n=ev[t])||void 0===n?void 0:n.offset,index:null===(r=ev[t])||void 0===r?void 0:r.index,part_idx:null===(i=ev[t])||void 0===i?void 0:i.part_idx}}),eA=ep.map(function(e,t){return es(es({},e),{},{index:t,id:t.toString()})}),ey=ec.article.comments.map(function(e,t){return es({text:e,id:t.toString()},ev[t])}),ew=ec.article.parts.map(function(e,t){return es(es({},e),{},{index:t,id:t.toString()})}),e_=new Map;r.forEach(function(e){e.tags.forEach(function(e){e_.set(e.type+"##"+e.name,e)})});var eO=[];eO.push((0,W.jsx)(A.A,{sx:{flex:1,overflowY:"scroll",p:1},children:$?(0,W.jsx)(ei,{article:eo,articleId:O,publicationId:$,publicationName:er.name,description:ex,comments:eb,contents:eA,patchable:H===el.originProofread}):null},"version_a")),H===el.origin||H===el.originProofread?eO.push((0,W.jsxs)(A.A,{sx:{flex:1,overflowY:"scroll"},children:[(0,W.jsxs)(A.A,{direction:"row",spacing:"10px",sx:{position:"fixed",bottom:20,right:20,zIndex:1,opacity:.7},children:[(0,W.jsx)(b.A,{onClick:function(){return B(z+.1)},variant:"contained",sx:{borderRadius:"100%",width:"50px",minWidth:"50px",height:"50px"},children:"+"}),(0,W.jsx)(b.A,{onClick:function(){return B(z-.1)},variant:"contained",sx:{borderRadius:"100%",width:"50px",minWidth:"50px",height:"50px"},children:"-"})]}),"db"!==er.type?"pdf"===er.type?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(w.A,{variant:"subtitle1",children:["来源文件(页码",eg,"-",ej,")",(0,W.jsx)("a",{href:er.files[0],target:"__blank",children:"[下载]"})]}),(0,W.jsx)(_.yo,{file:er.files[0]||"",options:{cMapUrl:"/pdfjs-dist/cmaps/",cMapPacked:!0},children:Array(ej-eg+1).fill(0).map(function(e,t){return(0,W.jsx)(_.YW,{pageNumber:t+eg,width:500*z},t)})})]}):"img"===er.type?er.files.filter(function(e,t){return t+1>=eg&&t+1<=ej}).map(function(e){return(0,W.jsx)("img",{alt:"",src:e,width:500*z},e)}):(0,W.jsx)(W.Fragment,{children:"未知类型"}):"无法预览（来自数据库文件）"]},"origin")):H===el.version&&eO.push((0,W.jsxs)(A.A,{sx:{flex:1},children:[(0,W.jsxs)(p.A,{children:[(0,W.jsx)(x.A,{children:"对比目标"}),(0,W.jsx)(f.A,{size:"small",value:V,input:(0,W.jsx)(g.A,{label:"对比目标"}),onChange:function(e){Y(e.target.value)},children:r.map(function(e){return(0,W.jsx)(j.A,{value:e.id,children:e.name},e.id)})})]}),(0,W.jsx)(A.A,{sx:{overflowY:"scroll"},children:V&&O?(0,W.jsx)(ei,{description:ec.article.description,articleId:O,article:ec.article,publicationId:V,comments:ey,contents:ew}):null})]},"version_b"),(0,W.jsxs)(A.A,{sx:{flex:1},children:[(0,W.jsxs)(p.A,{children:[(0,W.jsx)(x.A,{children:"对比模式"}),(0,W.jsxs)(f.A,{size:"small",value:J,input:(0,W.jsx)(g.A,{label:"对比模式"}),onChange:function(e){G(e.target.value)},children:[(0,W.jsx)(j.A,{value:ef.line,children:ef.line}),(0,W.jsx)(j.A,{value:ef.literal,children:ef.literal}),(0,W.jsx)(j.A,{value:ef.description_and_comments,children:ef.description_and_comments})]})]}),(0,W.jsx)(A.A,{sx:{overflowY:"scroll"},children:(0,W.jsx)(C.M,{diff:et})})]},"result"));var eC=(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(m.A,{size:{md:6,xs:12},children:(0,W.jsxs)(A.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,W.jsx)(w.A,{variant:"body1",children:"作者："}),(0,W.jsx)(A.A,{direction:"row",sx:{overflowX:"scroll",flex:1},children:(0,W.jsx)(k.A,{authors:eo.authors})}),r.map(function(e){return(0,W.jsx)("img",{alt:"",style:{cursor:"pointer"},onClick:function(){return window.open("https://github.com/banned-historical-archives/banned-historical-archives.github.io/issues?q=+".concat(encodeURIComponent('is:issue "'.concat(O,'" "').concat(e.id,'"')),"+"),"_blank")},src:"https://img.shields.io/github/issues-search/banned-historical-archives/banned-historical-archives.github.io?style=for-the-badge&color=%23cc0000&label=%E6%A0%A1%E5%AF%B9%E8%AE%B0%E5%BD%95&query=".concat(encodeURIComponent('is:issue "'.concat(O,'" "').concat(e.id,'"')))},e.id)})]})}),(0,W.jsx)(m.A,{size:{md:3,xs:12},children:(0,W.jsxs)(w.A,{variant:"body1",sx:{overflowX:"scroll"},children:["时间：",eo.is_range_date?"".concat(ed(eo.dates[0]),"-").concat(ed(eo.dates[1])):eo.dates.map(function(e){return ed(e)}).join(",")]})}),(0,W.jsx)(m.A,{size:{xs:12,md:3},children:(0,W.jsxs)(A.A,{direction:"row",alignItems:"center",children:[(0,W.jsx)(w.A,{variant:"body1",children:"标签："}),(0,W.jsx)(A.A,{direction:"row",spacing:1,alignItems:"center",sx:{flex:1,overflowX:"scroll"},children:(0,W.jsx)(S.A,{tags:Array.from(e_.values())})})]})}),(0,W.jsx)(m.A,{size:{xs:12,md:6},children:(0,W.jsxs)(A.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,W.jsx)(w.A,{variant:"body1",children:"选择来源："}),(0,W.jsx)(A.A,{direction:"row",spacing:1,sx:{flex:1,overflowX:"scroll"},children:r.map(function(e){return(0,W.jsx)(v.A,{label:e.name,variant:$===e.id?"filled":"outlined",color:$===e.id?"primary":"default",onClick:function(t){Z(e.id)}},e.id)})}),(0,W.jsx)(b.A,{variant:"outlined","aria-controls":en?"basic-menu":void 0,"aria-haspopup":"true",size:"small","aria-expanded":en?"true":void 0,onClick:function(e){return T(e.currentTarget)},children:"对比"}),(0,W.jsxs)(h.A,{id:"basic-menu",anchorEl:N,open:en,onClose:function(){return T(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:[(0,W.jsx)(j.A,{onClick:function(){X(el.origin),T(null)},children:"对比原始文件"}),(0,W.jsx)(j.A,{onClick:function(){X(el.originProofread),T(null)},children:"对比原始文件并校对"}),(0,W.jsx)(j.A,{onClick:function(){Y(1===M.current.length?M.current[0].id:M.current.find(function(e){return e.id!==er.id}).id),X(el.version),T(null)},children:"对比不同来源解析后的文本"}),(0,W.jsx)(j.A,{onClick:function(){var e=prompt("导入代码")||"";e=(e=e.replace(/^\{OCR补丁\}/,"")).substr(0,e.lastIndexOf("}")+1);try{var t=JSON.parse(e);ee(t.publicationId,t.patch),Y(ea),Z(t.publicationId),X(el.version),T(null)}catch(e){alert("解析错误")}},children:"导入代码对比OCR校对结果"}),(0,W.jsx)(j.A,{onClick:function(){X(el.none),T(null)},children:"取消"})]})]})})]});return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(A.A,{sx:{height:"100%",boxSizing:"border-box",background:"white",zIndex:1,top:0,left:0},pb:0,children:[(0,W.jsxs)(m.A,{container:!0,alignItems:"center",sx:{pt:2,pl:2,pr:2},spacing:2,children:[(0,W.jsx)(m.A,{size:{md:6,xs:10},children:(0,W.jsxs)(w.A,{variant:"body1",sx:{overflowX:"scroll"},children:["标题：",eo.title,eh.length?"(别名:".concat(eh.join(","),")"):""]})}),(0,W.jsx)(m.A,{size:2,sx:{display:{md:"none",xs:"flex"},justifyContent:"end"},children:(0,W.jsx)(b.A,{onClick:function(){return F(!D)},children:D?"隐藏":"展开"})}),D?eC:null]}),(0,W.jsx)(A.A,{direction:"row",divider:(0,W.jsx)(y.A,{orientation:"vertical",flexItem:!0}),spacing:2,sx:{flex:1,overflow:"auto",p:2},children:eO})]}),(0,W.jsx)(d(),{children:(0,W.jsxs)("title",{children:[eo.title," - 和谐历史档案馆 Banned Historical Archives"]})})]})}eh.getLayout=function(e){return(0,W.jsx)(O.A,{children:e})}},9820:(e,t,n)=>{"use strict";n.d(t,{PK:()=>r,cM:()=>i});var r=function(e){return e.articleCategory="文稿大类",e.articleType="文稿类型",e.place="地点",e.character="人物",e.issuer="出版方/发行方",e.subject="主题/事件",e.recorder="记录",e.reviewer="审核",e.translator="翻译",e.reprint="翻印/传抄",e}({}),i=function(e){return e.appellation="appellation",e.title="title",e.authors="authors",e.place="place",e.subtitle="subtitle",e.subtitle2="subtitle2",e.subtitle3="subtitle3",e.subtitle4="subtitle4",e.subtitle5="subtitle5",e.subdate="subdate",e.paragraph="paragraph",e.quotation="quotation",e.signature="signature",e.image="image",e.image_description="image_description",e}({})},7719:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/article",function(){return n(7275)}])},5352:()=>{},5365:()=>{},8196:()=>{},1671:()=>{},195:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[200,492,228,769,979,570,539,959,143,636,593,792],()=>t(7719)),_N_E=e.O()}]);